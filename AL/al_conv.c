#include <msp430.h>
#include <HAL/hal_gpio.h>
#include <HAL/hal_adc12.h>
#include <AL/al_conv.h>

extern ADC12Com ADC12Data;
ConversionData ConvertedData;

const unsigned short ir_front[512] = {1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1699,1685,1671,1657,1643,1630,1617,1604,1592,1579,1567,1555,1543,1531,1520,1508,1497,1486,1475,1464,1453,1443,1432,1422,1411,1401,1391,1381,1371,1361,1351,1342,1332,1322,1313,1303,1294,1285,1275,1266,1257,1248,1239,1230,1221,1212,1203,1194,1185,1176,1167,1158,1150,1141,1132,1124,1115,1107,1098,1090,1081,1073,1064,1056,1047,1039,1031,1023,1014,1006,998,990,982,974,966,958,950,942,934,926,918,910,902,895,887,879,872,864,857,849,842,834,827,820,813,805,798,791,784,777,770,763,756,749,743,736,729,723,716,710,703,697,691,684,678,672,666,660,654,648,642,636,630,625,619,613,608,602,597,592,586,581,576,571,566,561,556,551,546,542,537,532,528,523,519,514,510,506,501,497,493,489,485,481,477,473,470,466,462,459,455,451,448,444,441,438,435,431,428,425,422,419,416,413,410,407,404,401,399,396,393,391,388,386,383,381,378,376,373,371,369,366,364,362,360,357,355,353,351,349,347,345,343,341,339,337,335,333,332,330,328,326,324,323,321,319,317,316,314,312,311,309,307,306,304,302,301,299,298,296,294,293,291,290,288,287,285,284,282,281,279,278,276,275,273,272,270,269,267,266,264,263,261,260,258,257,255,254,252,251,249,248,246,245,243,242,240,239,237,236,234,233,231,230,228,227,226,224,223,221,220,218,217,215,214,212,211,209,208,207,205,204,202,201,200,198,197,195,194,193,191,190,188,187,186,184,183,182,181,179,178,177,175,174,173,172,170,169,168,167,166,164,163,162,161,160,159,158,157,156,154,153,152,151,150,149,148,147,146,146,145,144,143,142,141,140,139,138,138,137,136,135,134,134,133,132,131,131,130,129,128,128,127,126,126,125,124,124,123,122,122,121,120,120,119,118,118,117,117,116,115,115,114,113,113,112,111,111,110,109,108,108,107,106,105,105,104,103,102,101,101,100,99,98,97,96,95,94,93,92,91,90,89,87,86,85,84,83,81,80,79,77,76,75,73,72,70,69,67,66,64,62,61,59,57,56,54,52,50,49,47,45,43,41,39,38,36,34,32,30,28,26,25,23,21,19,17,16,14,12,11,9,8,6,5,4,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
const unsigned short ir_left[512] = {1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1687,1657,1629,1600,1573,1545,1519,1492,1467,1441,1417,1392,1368,1345,1322,1300,1277,1256,1234,1214,1193,1173,1153,1134,1115,1096,1078,1060,1043,1026,1009,992,976,960,945,930,915,900,886,872,858,844,831,818,806,793,781,769,757,746,735,724,713,702,692,682,672,662,653,644,635,626,617,608,600,592,584,576,568,561,553,546,539,532,525,518,512,506,499,493,487,481,475,470,464,459,454,448,443,438,433,429,424,419,415,410,406,402,398,393,389,385,382,378,374,370,367,363,360,356,353,350,347,343,340,337,334,331,328,326,323,320,317,315,312,309,307,304,302,299,297,295,292,290,288,285,283,281,279,277,275,272,270,268,266,264,262,260,258,257,255,253,251,249,247,246,244,242,240,239,237,235,233,232,230,228,227,225,224,222,220,219,217,216,214,213,211,210,208,207,205,204,202,201,199,198,197,195,194,192,191,190,188,187,185,184,183,181,180,179,178,176,175,174,172,171,170,169,168,166,165,164,163,162,160,159,158,157,156,155,154,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,131,130,129,128,127,126,125,125,124,123,122,122,121,120,119,119,118,117,116,116,115,114,114,113,113,112,111,111,110,110,109,108,108,107,107,106,106,105,105,104,104,103,103,103,102,102,101,101,101,100,100,99,99,99,98,98,98,97,97,97,96,96,96,96,95,95,95,95,94,94,94,94,93,93,93,93,92,92,92,92,92,91,91,91,91,91,90,90,90,90,90,89,89,89,89,89,88,88,88,88,87,87,87,87,87,86,86,86,86,85,85,85,85,84,84,84,83,83,83,82,82,82,81,81,81,80,80,79,79,79,78,78,77,77,76,76,75,75,74,74,73,73,72,72,71,70,70,69,68,68,67,66,66,65,64,63,63,62,61,60,60,59,58,57,56,55,54,53,53,52,51,50,49,48,47,46,45,44,43,42,41,40,38,37,36,35,34,33,32,31,30,29,27,26,25,24,23,22,21,20,18,17,16,15,14,13,12,11,10,9,7,6,5,4,3,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
const unsigned short ir_right[512] = {1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1678,1652,1626,1601,1576,1551,1527,1503,1480,1457,1434,1412,1390,1369,1348,1327,1307,1287,1267,1248,1229,1210,1192,1174,1156,1138,1121,1104,1088,1071,1055,1040,1024,1009,994,980,965,951,937,923,910,897,884,871,859,846,834,823,811,799,788,777,766,756,745,735,725,715,705,696,686,677,668,659,651,642,634,625,617,609,601,594,586,579,572,564,557,550,544,537,530,524,518,511,505,499,493,488,482,476,471,466,460,455,450,445,440,435,430,426,421,416,412,408,403,399,395,391,387,383,379,375,371,368,364,360,357,353,350,346,343,340,337,333,330,327,324,321,318,315,312,309,307,304,301,299,296,293,291,288,286,283,281,278,276,274,271,269,267,265,262,260,258,256,254,252,250,248,246,244,242,240,238,236,234,232,230,229,227,225,223,222,220,218,216,215,213,211,210,208,207,205,204,202,200,199,197,196,194,193,192,190,189,187,186,185,183,182,180,179,178,176,175,174,173,171,170,169,168,166,165,164,163,162,160,159,158,157,156,155,154,153,152,151,149,148,147,146,145,144,143,142,141,140,139,139,138,137,136,135,134,133,132,131,130,130,129,128,127,126,126,125,124,123,122,122,121,120,120,119,118,117,117,116,115,115,114,113,113,112,112,111,110,110,109,109,108,108,107,106,106,105,105,104,104,103,103,102,102,101,101,101,100,100,99,99,98,98,98,97,97,96,96,96,95,95,95,94,94,93,93,93,92,92,92,91,91,91,91,90,90,90,89,89,89,88,88,88,87,87,87,87,86,86,86,85,85,85,85,84,84,84,83,83,83,83,82,82,82,81,81,81,80,80,80,79,79,79,78,78,78,77,77,77,76,76,75,75,75,74,74,74,73,73,72,72,71,71,70,70,69,69,69,68,68,67,66,66,65,65,64,64,63,63,62,61,61,60,60,59,58,58,57,56,56,55,54,53,53,52,51,51,50,49,48,48,47,46,45,44,44,43,42,41,40,39,39,38,37,36,35,34,33,32,32,31,30,29,28,27,26,25,24,24,23,22,21,20,19,18,17,16,16,15,14,13,12,11,11,10,9,8,7,7,6,5,5,4,3,3,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

const unsigned short front_speed_tbl[212] = {30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,32,32,32,32,32,32,32,33,33,33,33,33,34,34,34,34,35,35,35,35,36,36,36,37,37,38,38,38,39,39,40,40,41,41,41,42,42,43,43,44,45,45,46,46,47,47,48,48,49,50,50,51,51,52,52,53,54,54,55,55,56,56,57,57,58,59,59,60,60,61,61,62,62,63,63,63,64,64,65,65,66,66,66,67,67,68,68,68,69,69,69,70,70,70,70,71,71,71,72,72,72,72,72,73,73,73,73,73,74,74,74,74,74,74,74,75,75,75,75,75,75,75,75,75,76,76,76,76,76,76,76,76,76,76,77,77,77,77,77,77,78,78,78,78,79,79,80};

void Fetch_Distance() {
    unsigned int idf, idr, idl;
    idf = (int)(ADC12Data.ADCBuffer[2] >> 3);
    idr = (int)(ADC12Data.ADCBuffer[0] >> 3);
    idl = (int)(ADC12Data.ADCBuffer[1] >> 3);

    ADC12Data.SensorFront = ir_front[idf];
    ADC12Data.SensorRight = ir_right[idr];
    ADC12Data.SensorLeft = ir_left[idl];
}
